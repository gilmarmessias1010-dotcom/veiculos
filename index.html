<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Cadastro de Ve√≠culos</title>

<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

<style>
* { box-sizing: border-box; }
body { font-family: Arial, sans-serif; background: #f1f5f9; padding: 20px; }
h1 { text-align: center; }
.card { background: #fff; padding: 15px; border-radius: 10px; margin-bottom: 15px; }
label { display: block; margin-top: 8px; font-weight: bold; }
input, select { width: 100%; padding: 8px; margin-top: 3px; }
button { margin-top: 10px; padding: 6px 12px; background: #2563eb; color: #fff; border: none; border-radius: 6px; cursor: pointer; }
table { width: 100%; border-collapse: collapse; font-size: 13px; }
th, td { border: 1px solid #ddd; padding: 6px; text-align: center; }
thead input { width: 100%; padding: 4px; font-size: 11px; }
.status-vencido { background:#fee2e2; }
.status-vencendo { background:#fef3c7; }
.status-emdia { background:#dcfce7; }
td.acoes { display:flex; gap:5px; justify-content:center; }
</style>
</head>

<body>

<h1>Cadastro de Ve√≠culos</h1>

<div class="card">
<form id="formVeiculo">
<input type="hidden" id="docId">

<label>Tipo</label>
<select id="tipo">
<option>Carro</option>
<option>Moto</option>
<option>Caminh√£o</option>
<option>Reboque</option>
<option>Semirreboque</option>
</select>

<label>Placa</label>
<input id="placa" required>

<label>Modelo</label>
<input id="modelo">

<label>Ano / Modelo</label>
<input id="anoModelo">

<label>Chassi</label>
<input id="chassi">

<label>Cor</label>
<input id="cor">

<label>Propriet√°rio</label>
<input id="proprietario">

<label>RENAVAM</label>
<input id="renavam">

<label>TARA (KG)</label>
<input id="tara">

<button type="submit">Salvar</button>
</form>
</div>

<div class="card">
<input type="file" accept=".xlsx" onchange="importarXLSX(this)">
<button onclick="imprimirFiltrados()">üñ®Ô∏è Imprimir filtrados</button>
</div>

<div class="card">
<table>
<thead>
<tr>
<th>Tipo</th><th>Placa</th><th>Modelo</th><th>Ano/Modelo</th>
<th>Chassi</th><th>Cor</th><th>Propriet√°rio</th><th>RENAVAM</th>
<th>TARA</th><th>Status</th><th>A√ß√µes</th>
</tr>
</thead>
<tbody id="lista"></tbody>
</table>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import {
  getFirestore, collection, addDoc,
  getDocs, deleteDoc, updateDoc, doc
} from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

/* üî¥ COLE AQUI OS DADOS DO SEU FIREBASE */
const firebaseConfig = {
  apiKey: "SUA_API_KEY",
  authDomain: "SEU_PROJETO.firebaseapp.com",
  projectId: "SEU_PROJETO",
  storageBucket: "SEU_PROJETO.appspot.com",
  messagingSenderId: "SEU_SENDER_ID",
  appId: "SEU_APP_ID"
};
/* =============================== */

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const col = collection(db, "veiculos");

let veiculos = [];

const statusMes = () => {
  let m = new Date().getMonth()+1;
  return m < 7 ? ["VENCIDO","status-vencido"] :
         m === 7 ? ["VENCE ESTE M√äS","status-vencendo"] :
         ["EM DIA","status-emdia"];
};

async function carregar(){
  const snap = await getDocs(col);
  veiculos = snap.docs.map(d => ({ id:d.id, ...d.data() }));
  listar();
}
window.onload = carregar;

formVeiculo.onsubmit = async e => {
  e.preventDefault();
  let id = docId.value;

  let dados = {
    tipo: tipo.value,
    placa: placa.value.toUpperCase(),
    modelo: modelo.value,
    anoModelo: anoModelo.value,
    chassi: chassi.value,
    cor: cor.value,
    proprietario: proprietario.value,
    renavam: renavam.value,
    tara: tara.value.replace(/\D/g,"")
  };

  id
    ? await updateDoc(doc(db,"veiculos",id),dados)
    : await addDoc(col,dados);

  formVeiculo.reset();
  docId.value="";
  carregar();
};

function listar(){
  lista.innerHTML="";
  veiculos.forEach(v=>{
    let [t,c] = statusMes();
    lista.innerHTML+=`
    <tr>
      <td>${v.tipo}</td>
      <td>${v.placa}</td>
      <td>${v.modelo}</td>
      <td>${v.anoModelo}</td>
      <td>${v.chassi}</td>
      <td>${v.cor}</td>
      <td>${v.proprietario}</td>
      <td>${v.renavam}</td>
      <td>${v.tara}</td>
      <td class="${c}">${t}</td>
      <td class="acoes">
        <button onclick="editar('${v.id}')">Editar</button>
        <button onclick="excluir('${v.id}')">Excluir</button>
      </td>
    </tr>`;
  });
}

window.editar = id => {
  let v = veiculos.find(x=>x.id===id);
  Object.keys(v).forEach(k=>document.getElementById(k)?.value=v[k]);
  docId.value=id;
  scrollTo(0,0);
};

window.excluir = async id => {
  if(confirm("Excluir ve√≠culo?")){
    await deleteDoc(doc(db,"veiculos",id));
    carregar();
  }
};

window.importarXLSX = input => {
  let r=new FileReader();
  r.onload=e=>{
    let wb=XLSX.read(e.target.result,{type:"binary"});
    let sh=wb.Sheets[wb.SheetNames[0]];
    let rows=XLSX.utils.sheet_to_json(sh,{header:1});
    rows.slice(1).forEach(row=>{
      if(row[1]) addDoc(col,{
        tipo:row[0]||"",
        placa:String(row[1]).toUpperCase(),
        modelo:row[2]||"",
        anoModelo:row[3]||"",
        chassi:row[4]||"",
        cor:row[5]||"",
        proprietario:row[6]||"",
        renavam:row[7]||"",
        tara:String(row[8]||"").replace(/\D/g,"")
      });
    });
    setTimeout(carregar,1000);
  };
  r.readAsBinaryString(input.files[0]);
};
</script>

</body>
</html>
